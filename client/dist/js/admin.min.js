app.factory("customerServices",function(e){return{getCustomerLeads:function(t,a,o){e({url:"/v1/customers/getCustomerLeads",method:"GET",params:t}).then(a,o)},getCustomerLeadDetails:function(t,a,o){e({url:"/v1/customers/getCustomerLeadDetails",method:"GET",params:{_id:t}}).then(a,o)},deleteCustomerLead:function(t,a,o){e({url:"/v1/customers/deleteCustomerLead",method:"DELETE",params:{_id:t}}).then(a,o)}}}),app.controller("customerCtrl",["$scope","$state","Notification","Upload","$stateParams","customerServices","NgTableParams",function(e,t,a,o,s,r,n){function c(){e.customerLead={name:"",contactPhone:[""],email:"",leadType:"",companyName:"",address:"",city:"",state:"",pinCode:"",erp:void 0,gps:void 0,load:void 0,yrsInService:"",operatingRoutes:[{source:"",destination:""}],customerProofs:"",files:"",companyName2:"",companyCity:"",companyPin:"",companyAddress:"",companyState:"",companyPhone:"",paymentType:"",loadPaymentToPayPercent:"",loadPaymentAdvancePercent:"",loadPaymentPodDays:"",tdsDeclarationDoc:"",leadSource:"",errorMessage:[]}}e.cancel=function(){t.go("customers.customersLead")},e.leadStatus=["Initiate","Duplicate","Junk Lead","Language Barrier","Callback","Not interested","Request for Approval"],e.status={isCustomHeaderOpen:!1,isFirstOpen:!0},e.leadType=["Truck Owner","Manufacturer","Commission Agent","Transporter","Factory Owners"],e.yrsInService=["2018","2017","2016"],e.serviceTeam=["Marketing Team","Cold Calls","Existing Customer","Self Generater","Employee","Partner","Public Relations","Direct Mail","Conference","Trade Show","Website","Word of mouth","Other"],e.customerProofs=["Aadhar Card","Passport"],e.paymentType=["Cheque","NEFT","Cash"],e.getCustomerLeadDetails=function(){s.customerId?r.getCustomerLeadDetails(s.customerId,function(t){t.data.status?e.customerLead=t.data.data:t.data.messages.forEach(function(e){a.error(e)})},function(e){}):c()},e.addRoutes=function(){var t=e.customerLead.operatingRoutes;console.log(t),t[t.length-1].source&&t[t.length-1].destination?t.push({source:"",destination:""}):a.error("Enter Source and Destination")},e.routeDel=function(){e.customerLead.operatingRoutes.splice(e.customerLead.operatingRoutes,1)},e.addNumber=function(){e.customerLead.contactPhone[e.customerLead.contactPhone.length-1]?e.customerLead.contactPhone.push(""):a.error("Enter Mobile Number")},e.removeNumber=function(){e.customerLead.contactPhone.splice(e.customerLead.contactPhone,1)},e.createLeads=function(){var t=e.customerLead;if(t.errorMessage=[],t.name||t.errorMessage.push("Enter Your Full Name"),function(){for(var t=0;t<e.customerLead.contactPhone.length;t++){if(!e.customerLead.contactPhone[t])return!1;if(t===e.customerLead.contactPhone.length-1)return!0}}()||t.errorMessage.push("Enter Mobile Number"),t.leadType||t.errorMessage.push("Pleas Select Customer Type"),t.errorMessage.length>0)t.errorMessage.forEach(function(e){a.error(e)});else if(e.customerLead._id){s=e.files;o.upload({url:"/v1/customers/updateCustomerLead",data:{files:[s]},params:e.customerLead}).then(function(e){e.data.status?(console.log("success.data.messages",e.data.messages),e.data.messages.forEach(function(e){a.success(e)}),c()):e.data.messages.forEach(function(e){a.error(e)})})}else{var s=e.files;o.upload({url:"/v1/customers/addCustomerLead",data:{files:[s]},params:e.customerLead}).then(function(e){e.data.status?(console.log(e.data.message),e.data.messages.forEach(function(e){a.success(e)}),c()):e.data.messages.forEach(function(e){a.error(e)})})}},e.delCustomer=function(e){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(t=>{t.value&&r.deleteCustomerLead(e,function(e){e.data.status?swal("Deleted!",e.data.messages[0],"success"):e.data.messages.forEach(function(e){a.error(e)})},function(e){})})},e.getCustomerLeads=function(){e.customerParams=new n({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:100,getData:function(t){var o={page:t.page(),size:t.count(),sort:t.sorting()};r.getCustomerLeads(o,function(o){o.data.status?(e.customerLeads=o.data.data,t.data=e.customerLeads,t.total(parseInt(o.data.count)),console.log(t.total())):o.data.messages.forEach(function(e){a.error({message:e})})},function(e){})}}),e.customerParams.reload()}}]),app.controller("orderProcessCtrl",["$scope","$state",function(e,t){e.cancel=function(){t.go("customers.customersLead")},e.leadStatus=["Initiate","Duplicate","Junk Lead","Language Barrier","Callback","Not interested","Request for Approval"],e.status={isCustomHeaderOpen:!1,isFirstOpen:!0}}]),app.controller("settingsCtrl",function(e,t,a){e.openPopup=function(){t.open({templateUrl:"addNewGPS.html"})},$ctrl.cancel=function(){a.dismiss("cancel")}});