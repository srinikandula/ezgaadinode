app.factory("GpsSettingsService",["$http",function(e){return{addSecret:function(t,a,r){e({url:"/v1/gps/addSecret",method:"POST",data:t}).then(a,r)},getAllSecrets:function(t,a){e({url:"/v1/gps/getAllSecrets",method:"GET"}).then(t,a)}}}]),app.controller("GpsSettingsCrtl",["$scope","GpsSettingsService","Notification","$state",function(e,t,a,r){e.secretkey="",e.addSecret=function(){e.secretkey?t.addSecret({secret:e.secretkey,email:e.email},function(e){e.data.status?(a.success(e.data.messages[0]),r.go("secretKeys")):a.error(e.data.messages[0])}):e.secretkeyerror="Please enter a secret key"},e.getAllSecrets=function(){t.getAllSecrets(function(t){t.data.status&&(e.secretKeys=t.data.secretKeys)})},e.getAllSecrets()}]),app.factory("AccountServices",["$http","$cookies",function(e,t){return{addAccount:function(t,a,r){e({url:"/v1/admin/accounts/add",method:"POST",data:t}).then(a,r)},getAllAccounts:function(t,a,r){e({url:"/v1/admin/accounts/fetch/",method:"GET",params:t}).then(a,r)},getAccount:function(t,a,r){e({url:"/v1/admin/accounts/"+t,method:"GET"}).then(a,r)},updateAccount:function(t,a,r){e({url:"/v1/admin/accounts/update",method:"PUT",data:t}).then(a,r)},updateNewAccount:function(t,a,r){e({url:"/v1/admin/accounts/newUpdate",method:"PUT",data:t}).then(a,r)},erpDashboard:function(t,a){e({url:"/v1/admin/erpDashboard",method:"GET"}).then(t,a)},count:function(t,a){e({url:"/v1/admin/accounts/total/count",method:"GET"}).then(t,a)},userProfile:function(t,a){e({url:"/v1/admin/userProfile",method:"GET"}).then(t,a)},addAccountGroup:function(t,a,r){e({url:"/v1/admin/addAccountGroup",method:"POST",data:t}).then(a,r)},countAccountGroups:function(t,a){e({url:"/v1/admin/countAccountGroups",method:"GET"}).then(t,a)},getAllAccountGroup:function(t,a,r){e({url:"/v1/admin/getAllAccountGroup",method:"GET",params:t}).then(a,r)},getAccountGroup:function(t,a,r){e({url:"/v1/admin/getAccountGroup/"+t,method:"GET"}).then(a,r)},updateAccountGroup:function(t,a,r){e({url:"/v1/admin/updateAccountGroup",method:"PUT",data:t}).then(a,r)},uploadUserProfilePic:function(t,a,r){e({url:"/v1/admin/uploadUserProfilePic",method:"POST",data:t}).then(a,r)},getErpSettings:function(t,a){e({url:"/v1/admin/getErpSettings",method:"GET"}).then(t,a)},updateErpSettings:function(t,a,r){e({url:"/v1/admin/updateErpSettings",method:"PUT",data:t}).then(a,r)},createKeyPair:function(t,a,r){e({url:"/v1/admin/createKeyPair/"+t.accountId,method:"GET"}).then(a,r)},getKeyPairsForAccount:function(t,a,r){e({url:"/v1/admin/getKeyPairsForAccount/"+t,method:"GET"}).then(a,r)}}}]),app.controller("ShowAccountsCtrl",["$scope","$uibModal","AccountServices","Notification","$state","paginationService","NgTableParams",function(e,t,a,r,n,s,o){e.goToEditAccountPage=function(e){n.go("accountsEdit",{accountId:e})},e.filter,e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();var i=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting()};r.filter=e.filter,e.loading=!0,a.getAllAccounts(r,function(a){e.invalidCount=0,angular.isArray(a.data.accounts)&&(e.loading=!1,e.accounts=a.data.accounts,t.total(a.data.count),t.data=e.accounts,e.currentPageOfAccounts=e.accounts)})};e.findAccounts=function(){e.accountParams.filter=e.filter,i(e.accountParams)},e.init=function(){e.accountParams=new o({page:1,size:10,sorting:{name:-1},filter:e.filter},{counts:[],total:e.count,getData:function(e){i(e)}})},e.goToEditAccountGroupPage=function(e){n.go("addGroup",{accountGroupId:e})},e.accountGroupFilter,e.accountGroupCount=0,e.getAccountGroupCount=function(){a.countAccountGroups(function(t){t.data.status?(e.accountGroupCount=t.data.count,e.initAccountGroup()):r.error({message:t.data.message})})},e.getAccountGroupCount();var u=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting()};r.filter=e.accountGroupFilter,e.loading=!0,a.getAllAccountGroup(r,function(a){e.invalidCount=0,angular.isArray(a.data.accountGroup)&&(e.loading=!1,e.accountGroup=a.data.accountGroup,t.total(a.data.count),t.data=e.accountGroup,e.currentPageOfAccountGroup=e.accountGroup)})};e.findAccountGroup=function(){e.accountGroupParams.filter=e.accountGroupFilter,u(e.accountGroupParams)},e.initAccountGroup=function(){e.accountGroupParams=new o({page:1,size:10,sorting:{name:-1},filter:e.accountGroupFilter},{counts:[],total:e.accountGroupCount,getData:function(e){u(e)}})}}]),app.controller("AddEditAccountCtrl",["$scope","Utils","$state","AccountServices","TrucksService","$stateParams","Notification","$uibModal",function(e,t,a,r,n,s,o,i){function u(){n.getAllTrucks({},function(t){if(t.data.status){if(e.trucks=t.data.trucks,console.log("$scope.group",e.group),e.group.truckIds.length>0)for(var a=0;a<e.trucks.length;a++)-1!=e.group.truckIds.indexOf(e.trucks[a]._id)?e.truckId2.push(!0):e.truckId2.push(!1)}else t.data.messages.forEach(function(e){o.error(t.data.message)})},function(e){o.error(e)})}function c(){r.getKeyPairsForAccount(e.addNewAccount._id,function(t){t.data.status&&(console.log(t.data.results),e.keys=t.data.results)},function(e){})}e.pagetitle="Add Account",e.account={profile:{userName:"",password:"",contactPhone:"",email:""},oldPassword:"",newPassword:"",confirmPassword:"",erpEnabled:"",gpsEnabled:"",isActive:!0,success:[],errors:[]},e.group={groupName:"",userName:"",password:"",confirmPassword:"",contactName:"",contactPhone:"",location:"",truckIds:[],erpEnabled:"",gpsEnabled:"",type:"",isActive:!0,success:[],errors:[]},e.addNewAccount={userName:"",password:"",contactPhone:"",erpEnabled:"",gpsEnabled:"",isActive:!0,success:[],errors:[]},s.accountId&&(e.pagetitle="Update Account",r.getAccount(s.accountId,function(t){t.data.status?(e.addNewAccount=t.data.account,c()):t.data.messages.forEach(function(e){o.error(e)})},function(e){})),e.addOrUpdateNewAccount=function(){var t=e.addNewAccount;t.errors=[],t.success=[],t._id||t.userName||t.errors.push("Invalid User Name"),t._id||t.password||t.errors.push("Invalid Password"),t._id||t.contactPhone||t.errors.push("Invalid Mobile Number"),t.errors.length||(t._id?r.updateNewAccount(t,function(e){e.data.status?(t.success=e.data.messages,a.go("accounts")):t.errors=e.data.messages},function(e){}):r.addAccount(t,function(e){e.data.status?(t.success=e.data.messages,a.go("accounts"),o.success({message:"Account Added Successfully"})):t.errors=e.data.messages},function(e){}))},e.trucks=[],e.dropdownSetting={scrollable:!0,scrollableHeight:"200px"},s.accountId?(e.pagetitle="Update Account",r.getAccount(s.accountId,function(t){t.data.status?e.account=t.data.account:t.data.messages.forEach(function(e){o.error(e)})},function(e){})):s.accountGroupId?(r.getAccountGroup(s.accountGroupId,function(t){t.data.status?e.group=t.data.accountGroup:t.data.messages.forEach(function(e){o.error(e)})},function(e){}),u()):u(),e.createKeyPair=function(e){r.createKeyPair({accountId:e},function(e){e.data.status&&c()},function(e){})},e.userProfilee=function(){r.userProfile(function(t){t.data.status?e.account=t.data.result:t.data.messages.forEach(function(e){o.error({message:e})})},function(e){})},e.addOrUpdateAccount=function(){var t=e.account;t.errors=[],t.success=[],t.profile.userName||t.errors.push("Invalid User Name"),t.profile.contactPhone||t.errors.push("Invalid Mobile Number"),t.profile.email||t.errors.push("Invalid Email"),t.oldPassword&&(t.newPassword||t.errors.push("Please Provide New Password"),t.confirmPassword!==t.newPassword&&t.errors.push("Passwords Not Matched")),t.errors.length||(t.profile._id?r.updateAccount(t,function(e){e.data.status?(t.success=e.data.messages,o.success({message:"Account Updated Successfully"}),a.go("myProfile")):t.errors=e.data.messages},function(e){}):r.addAccount(t,function(e){e.data.status?(t.success=e.data,a.go("myProfile"),o.success({message:"Account Added Successfully"})):t.errors=e.data.messages},function(e){}))},e.truckId2=[],e.truckSelected=function(t,a){if(t)e.group.truckIds.push(a);else{var r=e.group.truckIds.indexOf(a);e.group.truckIds.splice(r,1)}},e.addOrUpdateAccountGroup=function(){var t=e.group;t.errors=[],t.success=[],t.groupName||t.errors.push("Please Provide Group Name"),t.userName||t.errors.push("Please Provide User Name"),t.password||t.errors.push("Please Provide Password"),t.password!==t.confirmPassword&&t.errors.push("Passwords Not Matched"),t.contactName||t.errors.push("Please Provide Contact Name"),t.contactPhone||t.errors.push("Please Provide Mobile Number"),t.location||t.errors.push("Please Provide Location"),t.truckIds.length||t.errors.push("Please Select Atleast One Vehicle"),t.erpEnabled||t.gpsEnabled||t.errors.push("Please Select Either ERP or GPS"),t.errors.length||(t.type="group",t._id?r.updateAccountGroup(t,function(e){e.data.status?(t.success=e.data.messages,a.go("myGroup"),o.success({message:"Group Updated Successfully"})):t.errors=e.data.messages},function(e){}):r.addAccountGroup(t,function(e){e.data.status?(t.success=e.data.messages,a.go("myGroup"),o.success({message:"Group Added Successfully"})):t.errors=e.data.messages},function(e){}))},e.cancel=function(){a.go("accounts")},e.changeProfilePic=function(){i.open({animation:!1,templateUrl:"pop-up-modal.html",controller:"userProfilePicCtrl",size:"lg",windowClass:"profilePopup",resolve:{modelType:function(){return{data:"",model:"changeProfilePic"}}}}).result.then(function(e){e.status?(swal({type:"success",title:"Successfully Uploaded",showConfirmButton:!1,timer:1500}),a.go("myProfile",{},{reload:!0})):swal({type:"error",title:"Error While Uploading",showConfirmButton:!1,timer:1500})},function(){})}}]),app.controller("userProfilePicCtrl",["$scope","$uibModalInstance","AccountServices","$cookies","$rootScope","$state","modelType","Upload","$sce",function(e,t,a,r,n,s,o,i,u){e.myImage="",e.myCroppedImage="",e.closeModal=function(){t.dismiss("cancel")},e.uploadFile=function(t){if(t){var a=new FileReader;a.onload=function(t){e.$apply(function(e){e.myImage=t.target.result,console.log(e.myImage)})},a.readAsDataURL(t)}},e.template="views/partials/userProfile/userProfilePicModal.html",e.submitProfilePicture=function(e){a.uploadUserProfilePic({image:e},function(e){e.data.status?(r.put("profilePic",e.data.profilePic),n.profilePic=e.data.profilePic,t.close({status:!0,message:e.data.message})):swal(e.data.message,"Error","warning")},function(e){})}}]),app.controller("ERPSettingsCtrl",["$scope","AccountServices","Notification","$state","$stateParams",function(e,t,a,r,n){e.settings={revenue:{filterType:"",fromDate:"",toDate:""},payment:{filterType:"",fromDate:"",toDate:""},expense:{filterType:"",fromDate:"",toDate:""},expiry:{filterType:"",fromDate:"",toDate:""},tollCard:{filterType:"",fromDate:"",toDate:""},fuelCard:{filterType:"",fromDate:"",toDate:""},success:[],errors:[]},e.init=function(){t.getErpSettings(function(t){t.data.status?(e.settings=t.data.erpSettings,"custom"===e.settings.revenue.filterType&&(e.settings.revenue.fromDate=new Date(e.settings.revenue.fromDate),e.settings.revenue.toDate=new Date(e.settings.revenue.toDate)),"custom"===e.settings.payment.filterType&&(e.settings.payment.fromDate=new Date(e.settings.payment.fromDate),e.settings.payment.toDate=new Date(e.settings.payment.toDate)),"custom"===e.settings.expense.filterType&&(e.settings.expense.fromDate=new Date(e.settings.expense.fromDate),e.settings.expense.toDate=new Date(e.settings.expense.toDate)),"custom"===e.settings.tollCard.filterType&&(e.settings.tollCard.fromDate=new Date(e.settings.tollCard.fromDate),e.settings.tollCard.toDate=new Date(e.settings.tollCard.toDate)),"custom"===e.settings.fuelCard.filterType&&(e.settings.fuelCard.fromDate=new Date(e.settings.fuelCard.fromDate),e.settings.fuelCard.toDate=new Date(e.settings.fuelCard.toDate)),"custom"===e.settings.expiry.filterType&&(e.settings.expiry.fromDate=new Date(e.settings.expiry.fromDate),e.settings.expiry.toDate=new Date(e.settings.expiry.toDate))):t.data.messages.forEach(function(e){a.error(e)})},function(e){})},e.init(),e.updateCustomDate=function(t){var a=e.settings;a.errors=[],a.success=[],"revenue"===t?(e.settings.revenue.fromDate=new Date,e.settings.revenue.toDate=new Date):"payment"===t?(e.settings.payment.fromDate=new Date,e.settings.payment.toDate=new Date):"expense"===t?(e.settings.expense.fromDate=new Date,e.settings.expense.toDate=new Date):"tollCard"===t?(e.settings.tollCard.fromDate=new Date,e.settings.tollCard.toDate=new Date):"fuelCard"===t?(e.settings.fuelCard.fromDate=new Date,e.settings.fuelCard.toDate=new Date):"expiry"===t&&(e.settings.expiry.fromDate=new Date,e.settings.expiry.toDate=new Date)},e.editSettings=function(t){var r=e.settings;r.errors=[],r.success=[],"revenue"===t?r.revenue.fromDate&&r.revenue.toDate?r.revenue.fromDate>r.revenue.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):"payment"===t?r.payment.fromDate&&r.payment.toDate?r.payment.fromDate>r.payment.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):"expense"===t?r.expense.fromDate&&r.expense.toDate?r.expense.fromDate>r.expense.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):"tollCard"===t?r.tollCard.fromDate&&r.tollCard.toDate?r.tollCard.fromDate>r.tollCard.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):"fuelCard"===t?r.fuelCard.fromDate&&r.fuelCard.toDate?r.fuelCard.fromDate>r.fuelCard.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):"expiry"===t?r.expiry.fromDate&&r.expiry.toDate?r.expiry.fromDate>r.expiry.toDate?a.error({message:"Invalid Date Selection"}):e.updateSettings(r):a.error({message:"Please Provide From and To Dates"}):e.updateSettings(r)},e.updateSettings=function(r){t.updateErpSettings(r,function(t){t.data.status?(r.success=t.data.messages,e.init(),a.success({message:"Settings Updated Successfully"})):r.errors=t.data.messages},function(e){})}}]),app.factory("AnalyticsServices",["$http","$cookies",function(e,t){return{getLastLoginReports:function(t,a,r,n,s){e({url:"/v1/analytics/getReports/"+t+"/"+a+"/"+r,method:"GET"}).then(n,s)},getReportsByUserAgent:function(t,a,r,n,s){e({url:"/v1/analytics/getReportsByUserAgent/"+t+"/"+a+"/"+r,method:"GET"}).then(n,s)}}}]),app.controller("AnalyticsReportCtrl",["$scope","AnalyticsServices","$state","NgTableParams",function(e,t,a,r){e.dateParams={from:new Date,to:new Date},e.action="Select Action",e.getReports=function(){console.log(e.dateParams),t.getLastLoginReports(e.action,e.dateParams.from,e.dateParams.to,function(t){t.data.status&&(e.reports=t.data.results,console.log(e.reports))})},e.userAgent="Select User Agent",e.getReportsByUserAgent=function(){t.getReportsByUserAgent(e.userAgent,e.dateParams.from,e.dateParams.to,function(t){t.data.status&&(e.reportsByUserAgent=t.data.results,console.log(e.reportsByUserAgent))})}}]),app.controller("dashboardController",["$scope","$uibModal","TrucksService","Notification","$state","paginationService","NgTableParams","TripServices","ExpenseService","PartyService","PaymentsService","AccountServices","$stateParams",function(e,t,a,r,n,s,o,i,u,c,l,d,p){e.vehicleId=p.vehicleId,e.id=p.id,e.partyName=p.name,e.partyId=p.partyId,e.initializeparams=function(t){e.loading=!0,e.filters={fromDate:"",toDate:"",regNumber:"",error:[]},e.partyId="",e.regNumber=""},e.initializeparams(),e.gotoPayableBypartyId=function(t,a){e.partyName=a,e.getAmountsBypartyId(t),e.initializeparams()},e.erpDashBoard=function(){d.erpDashboard(function(t){t.data.status?e.totals=t.data.result:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.erpDashBoard(),e.getTruckExpires=function(){a.findExpiryTrucks({regNumber:e.regNumber},function(t){t.data.status?(e.expiryTrucks=t.data.expiryTrucks,e.table=$("#truckExpirylist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{responsivePriority:1}],data:t.data.expiryTrucks,columns:[{title:"Registration No",data:"registrationNo"},{title:"Fitness Expiry",data:"fitnessExpiry",render:function(e,t,a){return"--"!==e?new Date(e).toLocaleDateString():"--"}},{title:"Permit Expiry",data:"permitExpiry",render:function(e,t,a){return"--"!==e?new Date(e).toLocaleDateString():"--"}},{title:"Tax Expiry",data:"taxDueDate",render:function(e,t,a){return"--"!==e?new Date(e).toLocaleDateString():"--"}},{title:"Insurance Expiry",data:"insuranceExpiry",render:function(e,t,a){return"--"!==e?new Date(e).toLocaleDateString():"--"}},{title:"Pollution Expiry",data:"pollutionExpiry",render:function(e,t,a){return"--"!==e?new Date(e).toLocaleDateString():"--"}}]})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getRevenueByParty=function(){c.getRevenueByPartyId(p.id,function(t){t.data.status?(e.totalRevenueByVehicleId=t.data.totalRevenue,e.table=$("#revenueByPartylist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{orderable:!1,responsivePriority:1}],data:t.data.trips,columns:[{title:"Date",data:"date",render:function(e,t,a){return e?new Date(e).toLocaleDateString():"--"}},{title:"Trip ID",data:"tripId",render:function(e,t,a){return e||"--"}},{title:"Party Name",data:"attrs.partyName",render:function(e,t,a){return e||"--"}},{title:"Frieight Amount",data:"freightAmount",render:function(e,t,a){return e||"--"}},{title:"Expenses",data:"cost",render:function(e,t,a){return e||"--"}}],searching:!0})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getRevenueByVehicle=function(){i.findRevenueByVehicle({fromDate:e.filters.fromDate,toDate:e.filters.toDate,regNumber:e.regNumber},function(t){t.data.status?(e.revenueByVehicle=t.data.revenue,e.totalRevenue=t.data.grossAmounts,e.table=$("#revenuelist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{orderable:!0,targets:0,responsivePriority:1}],data:e.revenueByVehicle,columns:[{title:"Registration No",data:"attrs.truckName",render:function(e,t,a){return'<a href="#" class="ui-sref" >'+e+"</a>"}},{title:"Total Freight",data:"totalFreight"},{title:"Total Expense",data:"totalExpense"},{title:"Net Revenue",data:"totalRevenue"}],searching:!0}).on("click",".ui-sref",function(){var t=e.table.row($(this).parents("tr")).data();n.go("revenueByvehicleId",{vehicleId:t.attrs.truckName,id:t.registrationNo})})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getPaybleByParty=function(){u.getPaybleAmountByParty({fromDate:e.filters.fromDate,toDate:e.filters.toDate,partyId:e.partyId},function(t){t.data.status?(e.paybleList=t.data.paybleAmounts,e.gross=t.data.gross,e.table=$("#payablelist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{responsivePriority:1}],data:t.data.paybleAmounts,columns:[{title:"Party Name",data:"_id.name",render:function(e,t,a){return'<a href="#" class="ui-sref" >'+e+"</a>"}},{title:"Party Mobile",data:"_id.contact"},{title:"Total Amount",data:"totalAmount"},{title:"Paid Amount",data:"paidAmount"},{title:"Payable",data:"payableAmount"}]}).on("click",".ui-sref",function(){var t=e.table.row($(this).parents("tr")).data();n.go("payableByPartyName",{partyId:t._id._id,name:t._id.name})})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){}),c.getAllPartiesBySupplier(function(t){t.data.status?e.suppliersList=t.data.parties:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getAllTrucks=function(){a.getAllTrucksForFilter(function(t){t.data.status?e.trucksList=t.data.trucks:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.validateFilters=function(t){var a=e.filters;a.fromDate&&a.toDate||a.regNumber||a.error.push("Please Select Dates or Register Number"),new Date(a.fromDate)>new Date(a.toDate)&&a.error.push("Invalid Date Selection"),a.error.length||("expense"===t?e.getExpenseByVehicle():"revenue"===t&&e.getRevenueByVehicle())},e.selectTruckId=function(t){e.regNumber=t._id},e.selectPartyId=function(t){e.partyId=t._id},e.resetPartyName=function(){e.partyId=""},e.resetTruckName=function(){e.regNumber=""},e.getExpenseByVehicle=function(){u.findExpensesbyGroupVehicle({fromDate:e.filters.fromDate,toDate:e.filters.toDate,regNumber:e.regNumber},function(t){t.data.status?(e.totalExpenses=t.data.totalExpenses,e.table=$("#expenselist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{responsivePriority:1}],data:t.data.expenses,columns:[{title:"Registration No",data:"regNumber",render:function(e,t,a){return'<a href="#" class="ui-sref" >'+e+"</a>"}},{title:"Diesel",data:"exps[0].dieselExpense"},{title:"Toll",data:"exps[0].tollExpense"},{title:"Maintenance",data:"exps[0].mExpense"},{title:"Miscellaneous",data:"exps[0].misc"}]}).on("click",".ui-sref",function(){var t=e.table.row($(this).parents("tr")).data();n.go("expenseByVehicleId",{vehicleId:t.regNumber,id:t.id})})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getAmountsByparty=function(){l.getDuesByParty({fromDate:e.filters.fromDate,toDate:e.filters.toDate,partyId:e.partyId},function(t){t.data.status?(e.parties=t.data.parties,e.partiesAmount=t.data.grossAmounts,e.table=$("#receivablelist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{responsivePriority:1}],data:t.data.parties,columns:[{title:"Party Name",data:"attrs.partyName",render:function(e,t,a){return'<a href="#" class="ui-sref" >'+e+"</a>"}},{title:"Party Mobile",data:"attrs.partyContact"},{title:"Total Fright",data:"totalFright"},{title:"Paid Amount",data:"totalPayment"},{title:"Due Amount",data:"totalDue"}]}).on("click",".ui-sref",function(){var t=e.table.row($(this).parents("tr")).data();n.go("receivableByPartyName",{partyId:t.id,name:t.attrs.partyName})})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getTotalAmountReceivable=function(){l.getTotalPaymentsReceivable(function(t){t.data.status?e.amounts=t.data.amounts:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getAllParties=function(){c.getParties(null,function(t){t.data.status?e.partiesList=t.data.parties:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getAmountsBypartyWithFilters=function(){var t=e.filters;t.error=[],t.fromDate&&t.toDate||t.partyName||t.error.push("Please Select Dates or Party Name"),new Date(t.fromDate)>new Date(t.toDate)&&t.error.push("Invalid Date Selection"),t.error.length||e.getAmountsByparty()},e.getPaybleBypartyWithFilters=function(){var t=e.filters;t.error=[],t.fromDate&&t.toDate||t.partyName||t.error.push("Please Select Dates or Party Name"),new Date(t.fromDate)>new Date(t.toDate)&&t.error.push("Invalid Date Selection"),t.error.length||e.getPaybleByParty()},e.getexpenseByVehicleId=function(){u.findExpensesbyVehicleId(p.id,function(t){t.data.status?(e.expensesByVehicleId=t.data.expenses,e.totalExpenses=t.data.totalExpenses,e.table=$("#expenseByPartylist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{orderable:!0,responsivePriority:1}],data:t.data.expenses,columns:[{title:"Date",data:"date",render:function(e,t,a){return e?new Date(e).toLocaleDateString():"--"}},{title:"Diesel",data:"attrs.expenseName",render:function(e,t,a){return"diesel"==e.toLowerCase()?a.totalAmount:"0"}},{title:"Toll",data:"attrs.expenseName",render:function(e,t,a){return"toll"==e.toLowerCase()?a.totalAmount:"0"}},{title:"Maintenance",data:"attrs.expenseName",render:function(e,t,a){return"maintenance"==e.toLowerCase()?a.totalAmount:"0"}},{title:"Miscellaneous",data:"attrs.expenseName",render:function(e,t,a){return"diesel"==e.toLowerCase()||"toll"==e.toLowerCase()||"maintenance"==e.toLowerCase()?0:a.totalAmount}}],searching:!0})):r.error(t.data.message)},function(e){})},e.Expenseamount=0,e.GetExpense=function(e,t){return"diesel"==e.toLowerCase()||"toll"==e.toLowerCase()||"maintenance"==e.toLowerCase()?0:t},e.getAmountsBypartyId=function(){c.amountByPartyid(p.partyId,function(t){t.data.status?(e.amountPaid=t.data.totalPendingPayments,e.table=$("#amountsByPartylist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{orderable:!0,responsivePriority:1}],data:t.data.results,columns:[{title:"Date",data:"date",render:function(e,t,a){return e?new Date(e).toLocaleDateString():"--"}},{title:"Trip Id",data:"tripId",render:function(e,t,a){return e||""}},{title:"Registration No",data:"attrs.truckName",render:function(e,t,a){return e||""}},{title:"Freight Amount",data:"freightAmount",render:function(e,t,a){return e||""}},{title:"Paid Amount",data:"amount",render:function(e,t,a){return e||""}}],searching:!0})):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getPaybleAmountByPartyId=function(){u.getPaybleAmountByPartyId(p.partyId,function(t){t.data.status?(e.grossAmounts=t.data.grossAmounts,e.table=$("#payableByPartylist").DataTable({destroy:!0,responsive:!0,aLengthMenu:[[10,50,75,-1],[10,50,75,"All"]],iDisplayLength:10,sDom:"tp",order:[[0,"des"]],columnDefs:[{orderable:!0,responsivePriority:1}],data:t.data.partyData,columns:[{title:"Date",data:"date",render:function(e,t,a){return e?new Date(e).toLocaleDateString():"0"}},{title:"Expense Type",data:"expenseType.expenseName",render:function(e,t,a){return e||"0"}},{title:"Total Amount",data:"totalAmount",render:function(e,t,a){return e||"0"}},{title:"Paid Amount",data:"paidAmount",render:function(e,t,a){return e||"0"}},{title:"Payable",data:"payableAmount",render:function(e,t,a){return e||"0"}}],searching:!0})):t.data.message.forEach(function(e){r.error({message:e})})},function(e){})},e.shareRevenueDetailsByVechicleViaEmail=function(){swal({title:"Share revenue data using email",input:"email",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:t=>new Promise(a=>{i.shareRevenueDetailsByVechicleViaEmail({fromDate:e.filters.fromDate,toDate:e.filters.toDate,regNumber:e.regNumber,email:t,page:e.filters.page,sort:e.filters.sort,size:e.filters.size},function(e){e.data.status?a():e.data.messages.forEach(function(e){swal.showValidationError(e)})},function(e){})}),allowOutsideClick:!1}).then(e=>{e.value&&swal({type:"success",html:"Revenue details sent successfully"})})},e.sharePaymentsDetailsByPartyViaEmail=function(){swal({title:"Share payment data using email",input:"email",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:t=>new Promise(a=>{l.sharePaymentsDetailsByPartyViaEmail({fromDate:e.filters.fromDate,toDate:e.filters.toDate,partyId:e.partyId,email:t,page:e.filters.page,sort:e.filters.sort,size:e.filters.size},function(e){e.data.status?a():e.data.messages.forEach(function(e){swal.showValidationError(e)})},function(e){})}),allowOutsideClick:!1}).then(e=>{e.value&&swal({type:"success",html:"Payments details sent successfully"})})},e.shareExpensesDetailsViaEmail=function(){swal({title:"Share expense data using email",input:"email",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:t=>new Promise(a=>{u.shareExpensesDetailsViaEmail({fromDate:e.filters.fromDate,toDate:e.filters.toDate,regNumber:e.regNumber,email:t,page:e.filters.page,sort:e.filters.sort,size:e.filters.size},function(e){e.data.status?a():e.data.messages.forEach(function(e){swal.showValidationError(e)})},function(e){})}),allowOutsideClick:!1}).then(e=>{e.value&&swal({type:"success",html:"Expense details sent successfully"})})},e.shareExpairedDetailsViaEmail=function(){swal({title:"Share expiry data using email",input:"email",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:t=>new Promise(r=>{a.shareExpiredDetailsViaEmail({fromDate:e.filters.fromDate,toDate:e.filters.toDate,regNumber:e.regNumber,email:t,page:e.filters.page,sort:e.filters.sort,size:e.filters.size},function(e){e.data.status?r():e.data.messages.forEach(function(e){swal.showValidationError(e)})},function(e){})}),allowOutsideClick:!1}).then(e=>{e.value&&swal({type:"success",html:"Expiry details sent successfully"})})},e.sharePayableDetailsViaEmail=function(){swal({title:"Share payable data using mail",input:"email",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:t=>new Promise(a=>{u.sharePayableDetailsViaEmail({fromDate:e.filters.fromDate,toDate:e.filters.toDate,partyId:e.partyId,email:t,page:e.filters.page,sort:e.filters.sort,size:e.filters.size},function(e){e.data.status?a():e.data.messages.forEach(function(e){swal.showValidationError(e)})},function(e){})}),allowOutsideClick:!1}).then(e=>{e.value&&swal({type:"success",html:"Payble details sent successfully"})})},e.downloadRevenueDetailsByVechicle=function(){window.open("/v1/trips/downloadRevenueDetailsByVechicle?fromDate="+e.filters.fromDate+"&toDate="+e.filters.toDate+"&regNumber="+e.regNumber+"&page="+e.filters.page+"&sort="+JSON.stringify(e.filters.sort)+"&size="+e.filters.size)},e.downloadExpenseDetailsByVechicle=function(){window.open("/v1/expense/downloadExpenseDetailsByVechicle?fromDate="+e.filters.fromDate+"&toDate="+e.filters.toDate+"&regNumber="+e.regNumber+"&page="+e.filters.page+"&sort="+JSON.stringify(e.filters.sort)+"&size="+e.filters.size)},e.downloadPaymentDetailsByParty=function(){window.open("/v1/payments/downloadPaymentDetailsByParty?fromDate="+e.filters.fromDate+"&toDate="+e.filters.toDate+"&partyId="+e.partyId+"&page="+e.filters.page+"&sort="+JSON.stringify(e.filters.sort)+"&size="+e.filters.size)},e.downloadExpairyDetailsByTruck=function(){window.open("/v1/trucks/downloadExpiryDetailsByTruck?regNumber="+e.regNumber+"&page="+e.filters.page+"&sort="+JSON.stringify(e.filters.sort)+"&size="+e.filters.size)},e.downloadPaybleDetailsByParty=function(){window.open("/v1/expense/downloadPaybleDetailsByParty?partyId="+e.partyId+"&page="+e.filters.page+"&sort="+JSON.stringify(e.filters.sort)+"&size="+e.filters.size)}}]),app.factory("DriverService",["$http",function(e){return{addDriver:function(t,a,r){e({url:"/v1/drivers",method:"POST",data:t}).then(a,r)},getAllDrivers:function(t,a){e({url:"/v1/drivers/account/drivers",method:"GET"}).then(t,a)},getDrivers:function(t,a,r){e({url:"/v1/drivers/account/drivers",method:"GET",params:t}).then(a,r)},getDriver:function(t,a,r){e({url:"/v1/drivers/get/"+t,method:"GET"}).then(a,r)},updateDriver:function(t,a,r){e({url:"/v1/drivers/",method:"PUT",data:t}).then(a,r)},deleteDriver:function(t,a,r){e({url:"/v1/drivers/"+t,method:"DELETE"}).then(a,r)},count:function(t,a){e({url:"/v1/drivers/total/count",method:"GET"}).then(t,a)},getAllDriversForFilter:function(t,a){e({url:"/v1/drivers/getAllDriversForFilter",method:"GET"}).then(t,a)}}}]),app.controller("DriversListCtrl",["$scope","$state","DriverService","Notification","paginationService","NgTableParams",function(e,t,a,r,n,s){e.goToEditDriverPage=function(e){t.go("driversEdit",{driverId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();var o=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting(),driverName:t.driverName};e.loading=!0,a.getDrivers(r,function(a){e.invalidCount=0,angular.isArray(a.data.drivers)&&(e.loading=!1,e.drivers=a.data.drivers,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.drivers,e.currentPageOfDrivers=e.drivers)})};e.getAllDrivers=function(){a.getAllDriversForFilter(function(t){t.data.status?e.driversList=t.data.drivers:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.init=function(){e.driverParams=new s({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){o(t),e.getAllDrivers()}})},e.deleteDriver=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(r=>{r.value&&a.deleteDriver(t,function(t){t.data.status?(swal("Deleted!","Driver deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){swal("Error!",e,"error")})})})},e.searchByDriverName=function(t){e.driverParams=new s({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.driverName=t,o(e)}})}}]),app.controller("AddEditDriverCtrl",["$scope","$state","TrucksService","DriverService","Notification","Utils","$stateParams",function(e,t,a,r,n,s,o){function i(){a.getAllTrucks(1,function(t){if(t.data.status){e.trucks=t.data.trucks;var a=_.find(e.trucks,function(t){return t._id.toString()===e.driver.truckId});a&&(e.truckRegNo=a.registrationNo)}else t.data.messages.forEach(function(e){n.error(t.data.message)})},function(e){n.error(e)})}e.pagetitle="Add Driver",e.trucks=[],e.driver={fullName:"",truckId:"",accountId:"",mobile:"",joiningDate:"",licenseValidity:new Date,salary:"",licenseNumber:"",errors:[],isActive:!0},e.pageTitle="Add Driver",o.driverId?(e.pageTitle="Update Driver",r.getDriver(o.driverId,function(t){t.data.status?(e.driver=t.data.driver,e.driver.licenseValidity=new Date(e.driver.licenseValidity),i()):t.data.messages.forEach(function(e){n.error(e)})},function(e){})):i(),e.cancel=function(){t.go("drivers")},e.selectTruckId=function(t){e.driver.truckId=t._id},e.addOrSaveDriver=function(){var a=e.driver;console.log("params",a),a.errors=[],a.fullName||a.errors.push("Please provide driver's full name"),a.errors.length||(a._id?r.updateDriver(a,function(e){e.data.status?(n.success({message:"Driver Updated Successfully"}),t.go("drivers")):e.data.messages.forEach(function(e){n.error(e)})},function(e){console.log(e)}):r.addDriver(a,function(e){e.data.status?(n.success({message:"Driver Added Successfully"}),t.go("drivers")):e.data.messages.forEach(function(e){n.error(e)})},function(e){}))}}]),app.factory("ExpenseMasterServices",["$http",function(e){return{addExpense:function(t,a,r){e({url:"/v1/expenseMaster",method:"POST",data:t}).then(a,r)},getExpenses:function(t,a,r){e({url:"/v1/expenseMaster",method:"GET",params:t}).then(a,r)},deleteExpense:function(t,a,r){e({url:"/v1/expenseMaster/"+t,method:"DELETE"}).then(a,r)},getExpense:function(t,a,r){e({url:"/v1/expenseMaster/getExpense/"+t,method:"GET"}).then(a,r)},updateExpense:function(t,a,r){e({url:"/v1/expenseMaster",method:"PUT",data:t}).then(a,r)},count:function(t,a){e({url:"/v1/expenseMaster/count",method:"GET"}).then(t,a)}}}]),app.controller("ExpenseMasterCrtl",["$scope","$state","ExpenseMasterServices","NgTableParams","Notification",function(e,t,a,r,n){e.goToEditExpenseTypePage=function(e){t.go("expenseMasterEdit",{expenseTypeId:e})},e.count=0,a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):n.error({message:t.data.messages[0]})});e.init=function(){e.expenseMasterParams=new r({page:1,size:10,count:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){var r,n;n={page:(r=t).page(),size:r.count(),sort:r.sorting()},e.loading=!0,a.getExpenses(n,function(t){e.invalidCount=0,angular.isArray(t.data.expenses)&&(e.loading=!1,e.expenses=t.data.expenses,r.total(t.totalElements),r.data=e.expenses,e.currentPageOfexpenses=e.expenses)})}})},e.deleteExpense=function(t){a.deleteExpense(t,function(t){t.data.status?(e.count--,e.init(),n.error({message:"Successfully Deleted"})):n.error({message:t.data.message})})}}]),app.controller("ExpenseMasterEditCrtl",["$scope","$state","ExpenseMasterServices","Notification","$stateParams",function(e,t,a,r,n){e.pagetitle="Add Expense Type",e.cancel=function(){t.go("expenseMaster")},e.expenseType={expenseName:"",error:[],success:[]},n.expenseTypeId&&(e.pagetitle="Edit Expense Type",a.getExpense(n.expenseTypeId,function(t){t.data.status?e.expenseType=t.data.expenseType:r.error(t.data.messages[0])},function(e){})),e.cancel=function(){t.go("expense-master")},e.addOrUpdateExpenseType=function(){var n=e.expenseType;n.success=[],n.error=[],n.expenseName||n.error.push("Invalid Expense Type Name"),n.error.length||(n._id?a.updateExpense(n,function(e){e.data.status?(n.success=e.data.message,t.go("expense-master"),r.success({message:e.data.messages[0]})):n.error=e.data.message},function(e){}):a.addExpense(n,function(e){e.data.status?(n.success=e.data.message,t.go("expense-master"),r.success({message:e.data.messages[0]})):n.error=e.data.message},function(e){}))}}]),app.factory("ExpenseService",["$http",function(e){return{addExpense:function(t,a,r){e({url:"/v1/expense/addExpense",method:"POST",data:t}).then(a,r)},getExpenseRecords:function(t,a,r){e({url:"/v1/expense/"+t,method:"GET"}).then(a,r)},getAllRecords:function(t,a){e({url:"/v1/expense/getAll",method:"GET"}).then(t,a)},getExpenseRecord:function(t,a,r){e({url:"/v1/expense/getExpense/"+t,method:"GET"}).then(a,r)},getExpenses:function(t,a,r){e({url:"/v1/expense/getAllExpenses",method:"GET",params:t}).then(a,r)},updateRecord:function(t,a,r){e({url:"/v1/expense/updateExpense",method:"PUT",data:t}).then(a,r)},deleteRecord:function(t,a,r){e({url:"/v1/expense/"+t,method:"DELETE"}).then(a,r)},findTotalExpenses:function(t,a){e({url:"/v1/expense/total",method:"GET"}).then(t,a)},findExpensesbyGroupVehicle:function(t,a,r){e({url:"/v1/expense/groupByVehicle",method:"GET",params:t}).then(a,r)},findExpensesbyVehicleId:function(t,a,r){e({url:"/v1/expense/vehicleExpense/"+t,method:"GET"}).then(a,r)},count:function(t,a){e({url:"/v1/expense/total/count",method:"GET"}).then(t,a)},shareExpensesDetailsViaEmail:function(t,a,r){e({url:"/v1/expense/shareExpensesDetailsViaEmail",method:"GET",params:t}).then(a,r)},sharePayableDetailsViaEmail:function(t,a,r){e({url:"/v1/expense/sharePayableDetailsViaEmail",method:"GET",params:t}).then(a,r)},getPaybleAmountByParty:function(t,a,r){e({url:"/v1/expense/getPaybleAmountByParty",method:"GET",params:t}).then(a,r)},getPaybleAmountByPartyId:function(t,a,r){e({url:"/v1/expense/getPaybleAmountByPartyId",method:"GET",params:{partyId:t}}).then(a,r)}}}]),app.controller("ExpenseCtrl",["$scope","$state","ExpenseService","Notification","NgTableParams","paginationService","TrucksService",function(e,t,a,r,n,s,o){e.goToEditExpensePage=function(e){t.go("expensesEdit",{expenseId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();var i=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting(),truckNumber:t.truckNumber};e.loading=!0,a.getExpenses(r,function(a){e.invalidCount=0,angular.isArray(a.data.expenses)&&(e.loading=!1,e.maintanenceCosts=a.data.expenses,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.maintanenceCosts,e.currentPageOfMaintanence=e.maintanenceCosts)})};e.getAllTrucks=function(){o.getAllTrucksForFilter(function(t){t.data.status?e.trucksList=t.data.trucks:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.init=function(){e.expenseParams=new n({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){i(t),e.getAllTrucks()}})},e.deleteExpenseRecord=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(n=>{n.value&&a.deleteRecord(t,function(t){t.data.status?(swal("Deleted!","Expenses deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){r.error({message:e})})})})},e.searchByVechicleNumber=function(t){e.expenseParams=new n({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.truckNumber=t,i(e)}})}}]),app.controller("expenseEditController",["$scope","ExpenseService","PartyService","$stateParams","$state","DriverService","Notification","TrucksService","ExpenseMasterServices",function(e,t,a,r,n,s,o,i,u){function c(){a.getAllPartiesBySupplier(function(t){if(t.data.status){e.partyBySupplier=t.data.parties;var a=_.find(e.partyBySupplier,function(t){return t._id.toString()===e.expenseDetails.partyId});a&&(e.partyName=a.name)}else o.error(t.data.message)})}function l(t){u.getExpenses(t,function(t){if(t.data.status){e.expenses=t.data.expenses;var a=_.find(e.expenses,function(t){return t._id.toString()===e.expenseDetails.expenseType});a&&(e.expenseTitle=a.expenseName)}else o.error(t.data.message)},function(e){})}function d(){i.getAllTrucksForFilter(function(t){if(t.data.status){e.trucks=t.data.trucks;var a=_.find(e.trucks,function(t){return t._id.toString()===e.expenseDetails.vehicleNumber});a&&(e.truckRegNo=a.registrationNo,console.log("success",e.truckRegNo))}else o.error(t.data.message)},function(e){})}e.pagetitle="Add Expenses",e.dateCallback="past",e.trucks=[],e.expenses=[],e.parties=[],e.expenseDetails={vehicleNumber:"",expenseType:"",description:"",partyId:void 0,totalAmount:0,paidAmount:0,cost:0,date:"",mode:"",expenseName:"",error:[],success:[]},e.cancel=function(){n.go("expenses")},e.addExpenseTypeField=!1,e.addExpenseType=function(){e.addExpenseTypeField=!0},e.selectPartyId=function(t){e.expenseDetails.partyId=t._id},e.selectExpenseType=function(t){e.expenseDetails.expenseType=t._id},e.selectTruckId=function(t){e.expenseDetails.vehicleNumber=t._id},r.expenseId?(e.pagetitle="Edit expenses",t.getExpenseRecord(r.expenseId,function(t){t.data.status?(e.expenseDetails=t.data.expense,e.expenseDetails.date=new Date(e.expenseDetails.date),l(),d(),c()):o.error(t.data.message)},function(e){})):(l(),d(),c()),e.AddorUpdateExpense=function(){var a=e.expenseDetails;a.error=[],a.success=[],a.vehicleNumber||a.error.push("Invalid vehicle Number"),a.expenseType||a.error.push("Invalid expenseType"),"others"!==a.expenseType||a.expenseName||a.error.push("Enter other expenseType"),a.date||a.error.push("Invalid date"),a.mode||a.error.push("Please Select Cash or Credit"),_.isNumber(a.cost)||"Cash"!==a.mode||a.error.push("Invalid Total Expense Amount"),a.partyId||"Credit"!==a.mode||a.error.push("Please Select party"),a.totalAmount||"Credit"!==a.mode||a.error.push("Please Enter Total Expense Amount"),_.isNumber(a.paidAmount)||"Credit"!==a.mode||a.error.push("Invalid Paid Amount"),"Credit"===a.mode&&a.paidAmount>a.totalAmount&&a.error.push("Paid Amount Should be less than total Amount"),a.error.length||(r.expenseId?t.updateRecord(a,function(e){e.data.status?(o.success({message:e.data.message}),n.go("expenses")):e.data.messages.forEach(function(e){o.error({message:e})})},function(e){}):t.addExpense(a,function(e){e.data.status?(a.success=e.data.message,e.data.messages.forEach(function(e){o.success({message:e})}),n.go("expenses")):e.data.messages.forEach(function(e){o.error({message:e})})}))}}]),app.factory("GpsService",["$http",function(e){return{addDevice:function(t,a,r){e({url:"/v1/gps/addDevice",method:"POST",data:t}).then(a,r)},getDevices:function(t,a){e({url:"/v1/gps/getDevices",method:"GET"}).then(t,a)},gpsTrackingByMapView:function(t,a){e({url:"/v1/gps/gpsTrackingByMapView",method:"GET"}).then(t,a)}}}]),app.controller("GpsCtrl",["$scope","$state","GpsService","Notification","NgTableParams","paginationService","TrucksService",function(e,t,a,r,n,s,o){e.getDevices=function(){a.getDevices(function(t){t.data.status?e.devicesList=t.data.devices:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getAllTrucks=function(){o.getAllTrucksForFilter(function(t){t.data.status?e.trucksList=t.data.trucks:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.device={deviceId:"",truckId:"",errors:[],success:[]},e.addDevice=function(){console.log("devices");var t=e.device;t.errors=[],t.deviceId||t.errors.push("Please provide device id"),t.truckId||t.errors.push("select truck number"),t.simNumber||t.errors.push("select truck number"),t.imei||t.errors.push("select truck number"),t.errors.length||a.addDevice(e.device,function(t){t.data.status?(t.data.messages.forEach(function(e){r.success({message:e})}),e.getDevices()):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.gpsTrackingByMapView=function(){a.gpsTrackingByMapView(function(e){console.log("response",e)},function(e){})}}]),app.factory("groupMapService",["$http","$cookies",function(e,t){return{getGroupMap:function(t,a){e({url:"/v1/events/get/groupMap",method:"GET",data:t}).then(t,a)},getParties:function(t,a){e({url:"/v1/party/get/accountParties",method:"GET"}).then(t,a)}}}]),app.controller("GroupMapController",["$scope","$state","groupMapService","GpsService",function(e,t,a,r){var n=[],s=[],o=[];e.gpsTrackingByMapView=function(){r.gpsTrackingByMapView(function(t){t.data.status?(n=t.data.data,s=t.data.regNos,o=t.data.truckTypes,e.loadData()):Notification.error(t.data.message)},function(e){})},e.loadData=function(){for(var e,t=new google.maps.Map(document.getElementById("map"),{zoom:7,center:new google.maps.LatLng(18.2699,78.0489),mapTypeId:google.maps.MapTypeId.ROADMAP}),a=new google.maps.InfoWindow,r=0;r<n.length;r++)e=new google.maps.Marker({position:new google.maps.LatLng(n[r].location.coordinates[1],n[r].location.coordinates[0]),icon:"/images/Track_Vehicle_Red.png",map:t}),google.maps.event.addListener(e,"click",function(e,r){return function(){a.setContent(s[r]+"<br>"+o[r]),a.open(t,e)}}(e,r))},e.gpsTrackingByMapView()}]),app.factory("GroupServices",["$http",function(e){return{addGroup:function(t,a,r){e({url:"/v1/group/addGroup",method:"POST",data:t}).then(a,r)},getGroups:function(t,a,r){e({url:"/v1/group/getGroups/",method:"GET",params:t}).then(a,r)},getGroup:function(t,a,r){e({url:"/v1/group/getGroup/"+t,method:"GET"}).then(a,r)},updateGroup:function(t,a,r){e({url:"/v1/group/updateGroup",method:"PUT",data:t}).then(a,r)},forgotPassword:function(t,a,r){e({url:"/v1/group/forgot-password",method:"POST",data:t}).then(a,r)},verifyOtp:function(t,a,r){e({url:"/v1/group/verify-otp",method:"POST",data:t}).then(a,r)},count:function(t,a){e({url:"/v1/group/total/count",method:"GET"}).then(t,a)}}}]),app.controller("GroupCtrl",["$scope","$state","GroupServices","Notification","paginationService","NgTableParams",function(e,t,a,r,n,s){e.goToEditGroupPage=function(e){t.go("groupsEdit",{groupId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();e.init=function(){e.groupParams=new s({page:1,size:10,sorting:{name:-1}},{counts:[],total:e.count,getData:function(t){var r,n;n={page:(r=t).page(),size:r.count(),sort:r.sorting()},e.loading=!0,a.getGroups(n,function(t){e.invalidCount=0,angular.isArray(t.data.groups)&&(e.loading=!1,e.groups=t.data.groups,r.total(t.totalElements),r.data=e.groups,e.currentPageOfGroups=e.groups)})}})}}]),app.controller("groupEditController",["$scope","GroupServices","AccountServices","TrucksService","Notification","$stateParams","Utils","$state","$cookies",function(e,t,a,r,n,s,o,i,u){e.pagetitle="Add Group",e.trucks=[],e.checkedTrucks=[],e.uncheckedTruckList=[],e.groupDetails={name:"",userName:"",password:"",status:!0,isActive:!0,errors:[]},e.getGroupDetails=function(){s.groupId?(e.pagetitle="Update Group",t.getGroup(s.groupId,function(t){t.data.status?(e.groupDetails=t.data.group,e.groupId=e.groupDetails._id):t.data.messages.forEach(function(e){n.error(e)})},function(e){n.error(e)})):e.goToGroupsPage=function(){i.go("groups")},l(),r.getUnAssignedTrucks({groupId:e.groupId},function(t){t.data.status&&(e.trucksList=t.data.trucks)})},e.goToGroupsPage=function(){i.go("groups")};var c=[];function l(){r.getAccountTrucks(e.pageNumber,function(t){t.data.status&&(e.allTrucks=t.data.trucks,e.allTrucks.forEach(function(t){t.groupId===e.groupId&&e.trucksList.push(t)}),e.trucksList.forEach(function(t,a){t.groupId&&(e.checkboxModel[a]=t._id)}))})}e.checkboxModel=[],e.AddorUpdateGroup=function(){c=e.groupDetails,e.checkboxModel.forEach(function(t){console.log("assignedTruck",t),t&&e.checkedTrucks.push(t)}),console.log(e.checkedTrucks),c.errors=[],c._id&&delete c.password,c.name||c.errors.push("Invalid group name"),c.userName||c.errors.push("Invalid user name"),c._id||o.isValidPassword(c.password)||c.errors.push("Password must have  minimum 7 characters"),c.errors.length||(c._id?(e.trucksList.forEach(function(t,a){t.groupId&&(e.checkboxModel[a]||e.uncheckedTruckList.push(t._id))}),r.unAssignTrucks(e.uncheckedTruckList,function(e){e.data.status},function(e){}),r.assignTrucks({groupId:e.groupDetails._id,trucks:e.checkedTrucks},function(e){e.data.status},function(e){}),t.updateGroup(c,function(e){e.data.status?(i.go("groups"),n.success({message:"Group Updated Successfully"})):c.errors=e.data.messages},function(e){})):t.addGroup(c,function(t){console.log(t),t.data.status?(r.assignTrucks({groupId:e.groupId,trucks:e.checkedTrucks},function(e){e.data.status&&l()},function(e){}),i.go("groups"),n.success({message:"Group Added Successfully"})):c.errors=t.data.messages},function(e){n.error(e)}))},e.pageNumber=0}]),app.controller("LoginCtrl",["$scope","Utils","CommonServices","$state","$cookies","$rootScope","GroupServices",function(e,t,a,r,n,s,o){t.isLoggedIn()&&r.go("reports"),e.loginParams={userName:n.get("rememberUserName"),password:n.get("rememberPassword"),contactPhone:n.get("rememberContactPhone"),errors:[]},e.login=function(){var t=e.loginParams;t.errors=[],t.userName||t.errors.push("Invalid User Name"),t.password||t.errors.push("Invalid Password"),t.contactPhone||t.errors.push("Invalid Contact Number"),t.errors.length||(e.rememberMe(),a.login(e.loginParams,function(e){e.data.status?(n.put("token",e.data.token),n.put("type",e.data.type),n.put("userName",e.data.userName),n.put("editAccounts",e.data.editAccounts),n.put("profilePic",e.data.profilePic),s.loggedTrue(),r.go("reports")):t.errors=e.data.messages},function(e){}))},e.otpField=!1,e.forgotPassword=function(){var t=e.loginParams;t.errors=[],t.contactPhone||t.errors.push("Invalid Contact Number"),t.errors.length||o.forgotPassword(e.loginParams,function(a){a.data.status?(t.success=a.data.messages,e.otpField=!0):t.errors=a.data.messages},function(e){})},e.otpParams={contactPhone:"",otp:"",errors:[]},e.otpValidate=function(){var t=e.otpParams;e.otpParams.contactPhone=e.loginParams.contactPhone,t.errors=[],t.errors.length||(console.log("Cphone",e.otpParams),o.verifyOtp(e.otpParams,function(e){e.data.status?t.success=e.data.messages:t.errors=e.data.messages},function(e){}))},e.rememberMe=function(){e.remember&&(n.put("rememberUserName",e.loginParams.userName),n.put("rememberPassword",e.loginParams.password),n.put("rememberContactPhone",e.loginParams.contactPhone))}}]),app.controller("NavCtrl",["$scope","$state","Utils","AccountServices","$cookies","$rootScope",function(e,t,a,r,n,s){e.logout=function(){a.logout(),n.remove("token"),n.remove("userName"),e.displayName="",s.loggedTrue(),t.go("login")},e.isLoggedIn=function(){return void 0!=n.get("token")},e.loggedInName=function(){e.displayName=n.get("userName")},e.loggedInName(),e.isLoggedInn="",s.loggedTrue=function(){n.get("token")?e.isLoggedInn=!0:(e.isLoggedInn=!1,t.go("login"))},s.loggedTrue(),e.isLoggedin=n.get("token"),e.loginParams={userName:"",password:"",contactPhone:"",email:"",errors:[]}}]).controller("LeftNavCtrl",["$scope","$rootScope","$state","Utils","$cookies","$stateParams",function(e,t,a,r,n,s){e.canEditAccounts=function(){return"true"==n.get("editAccounts")}}]),app.factory("PartyService",["$http","$cookies",function(e,t){return{addParty:function(t,a,r){e({url:"/v1/party/addParty",method:"POST",data:t}).then(a,r)},getParties:function(t,a,r){e({url:"/v1/party/get/accountParties",method:"GET",params:t}).then(a,r)},getAccountParties:function(t,a){e({url:"/v1/party/get/accountParties",method:"GET"}).then(t,a)},getAllPartiesByTransporter:function(t,a){e({url:"/v1/party/getAllPartiesByTransporter",method:"GET"}).then(t,a)},getAllPartiesBySupplier:function(t,a){e({url:"/v1/party/getAllPartiesBySupplier",method:"GET"}).then(t,a)},getParty:function(t,a,r){e({url:"/v1/party/"+t,method:"GET"}).then(a,r)},updateParty:function(t,a,r){e({url:"/v1/party/updateParty",method:"PUT",data:t}).then(a,r)},deleteParty:function(t,a,r){e({url:"/v1/party/"+t,method:"DELETE"}).then(a,r)},getRevenueByPartyId:function(t,a,r){e({url:"/v1/party/vehiclePayments/"+t,method:"GET"}).then(a,r)},amountByPartyid:function(t,a,r){e({url:"/v1/party/tripsPayments/"+t,method:"GET"}).then(a,r)},count:function(t,a){e({url:"/v1/party/total/count",method:"GET"}).then(t,a)},getAllPartiesForFilter:function(t,a){e({url:"/v1/party/getAllPartiesForFilter",method:"GET"}).then(t,a)}}}]),app.controller("PartyListController",["$scope","$uibModal","PartyService","Notification","$state","paginationService","NgTableParams",function(e,t,a,r,n,s,o){e.goToEditPartyPage=function(e){n.go("editParty",{partyId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})};var i=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting(),partyName:t.partyName};e.loading=!0,a.getParties(r,function(a){e.invalidCount=0,angular.isArray(a.data.parties)&&(e.loading=!1,e.parties=a.data.parties,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.parties,e.currentPageOfParties=e.parties)})};e.getAllParties=function(){a.getAllPartiesForFilter(function(t){t.data.status?e.partiesList=t.data.parties:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.init=function(){e.partyParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){i(t),e.getAllParties()}})},e.getCount(),e.deleteParty=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(n=>{n.value&&a.deleteParty(t,function(t){t.data.status?(swal("Deleted!","Party deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})})},e.searchByPartyName=function(t){e.partyParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.partyName=t,i(e)}})}}]),app.controller("AddEditPartyCtrl",["$scope","Utils","PartyService","$rootScope","$stateParams","Notification","$state",function(e,t,a,r,n,s,o){e.showAddTripLane=!1,e.addTripLane=function(){e.showAddTripLane=!0},e.pageTitle="Add Party",n.partyId&&(e.pageTitle="Edit Party"),e.party={name:"",contact:"",email:"",city:"",tripLanes:[{index:0}],partyType:"",isEmail:!1,isSms:!1,error:[],success:[]},n.partyId&&a.getParty(n.partyId,function(t){t.data.status?e.party=t.data.party:s.error(t.data.message)},function(e){}),e.addTripLane=function(){e.party.error=[];var t=e.party.tripLanes.length;e.party.tripLanes[t-1].name&&e.party.tripLanes[t-1].from&&e.party.tripLanes[t-1].to?e.party.tripLanes.push({index:t}):e.party.error.push("Please Fill all TripLane Fields")},e.deleteTripLane=function(t){e.party.tripLanes.length>1?e.party.tripLanes.splice(t,1):e.party.error.push("Please add at least one trip lane")},e.addOrUpdateParty=function(){var r=e.party;if(r.success=[],r.error=[],r.name||r.error.push("Invalid party name"),t.isValidPhoneNumber(r.contact)||r.error.push("Invalid mobile number"),t.isValidEmail(r.email)||r.error.push("Invalid email ID"),r.city||r.error.push("Invalid city"),r.partyType||r.error.push("Please select party type"),"Transporter"===r.partyType){r.isSms||r.isEmail||r.error.push("Please select notification type");for(var n=0;n<r.tripLanes.length;n++)r.tripLanes[n].name||r.error.push("Please provide TripLane Name"),r.tripLanes[n].from||r.error.push("Please provide From Name"),r.tripLanes[n].to||r.error.push("Please provide To Name")}r.error.length||(r._id?a.updateParty(e.party,function(e){e.data.status?(o.go("parties"),s.success({message:"Party Updated Successfully"})):e.data.messages.forEach(function(e){s.error({message:e})})},function(e){}):a.addParty(e.party,function(e){e.data.status?(r.success=e.data.message,o.go("parties"),s.success({message:"Party Added Successfully"})):e.data.messages.forEach(function(e){s.error({message:e})})},function(e){}))},e.cancel=function(){o.go("parties")}}]),app.factory("PaymentsService",["$http",function(e){return{addPayments:function(t,a,r){e({url:"/v1/payments/addPayments",method:"POST",data:t}).then(a,r)},getPaymentsRecords:function(t,a,r){e({url:"/v1/payments/"+t,method:"GET"}).then(a,r)},getAllRecords:function(t,a){e({url:"/v1/payments/getAll",method:"GET"}).then(t,a)},getPaymentsRecord:function(t,a,r){e({url:"/v1/payments/getPaymentsRecord/"+t,method:"GET"}).then(a,r)},getPayments:function(t,a,r){e({url:"/v1/payments/getPayments/",method:"GET",params:t}).then(a,r)},getTotalPaymentsReceivable:function(t,a){e({url:"/v1/payments/getTotalAmount/",method:"GET"}).then(t,a)},getDuesByParty:function(t,a,r){e({url:"/v1/payments/getDuesByParty/",method:"GET",params:t}).then(a,r)},updateRecord:function(t,a,r){e({url:"/v1/payments/updatePayments",method:"PUT",data:t}).then(a,r)},deletePaymentsRecord:function(t,a,r){e({url:"/v1/payments/"+t,method:"DELETE"}).then(a,r)},count:function(t,a){e({url:"/v1/payments/countPayments",method:"GET"}).then(t,a)},sharePaymentsDetailsByPartyViaEmail:function(t,a,r){e({url:"/v1/payments/sharePaymentsDetailsByPartyViaEmail",method:"GET",params:t}).then(a,r)}}}]),app.controller("PaymentsCtrl",["$scope","$state","PaymentsService","Notification","NgTableParams","paginationService","PartyService",function(e,t,a,r,n,s,o){var i;e.goToEditPaymentsPage=function(e){t.go("paymentsEdit",{paymentsId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();var u=function(t){i={page:t.page(),size:t.count(),sort:t.sorting(),partyName:t.partyName},e.loading=!0,a.getPayments(i,function(a){e.invalidCount=0,angular.isArray(a.data.paymentsCosts)&&(e.loading=!1,e.payments=a.data.paymentsCosts,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.payments,e.currentPageOfPayments=e.payments)})};e.getAllParties=function(){o.getAllPartiesForFilter(function(t){t.data.status?e.partiesList=t.data.parties:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.init=function(){e.paymentParams=new n({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){u(t),e.getAllParties()}})},e.deletePaymentsRecord=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(r=>{r.value&&a.deletePaymentsRecord(t,function(t){t.data.status?(swal("Deleted!","Party deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){swal("Error!",e,"error")})})})},e.searchByPartyName=function(t){e.paymentParams=new n({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.partyName=t,u(e)}})}}]),app.controller("paymentsEditController",["$scope","PaymentsService","$stateParams","$state","Notification","TripServices","TrucksService","PartyService",function(e,t,a,r,n,s,o,i){function u(){s.getPartiesByTrips(function(t){if(t.data.status){e.parties=t.data.partyList;var a=_.find(e.parties,function(t){return t._id.toString()===e.paymentsDetails.partyId});a&&(e.partyName=a.name)}else t.data.messages.forEach(function(e){n.error(e)})},function(e){})}e.paymentRefNumber=!1,e.refNum=function(){e.paymentRefNumber=!0},e.pagetitle="Add Payments",e.dateCallback="past",e.paymentsDetails={date:"",partyId:"",description:"",amount:"",paymentType:"",paymentRefNo:"",error:[],success:[]},e.cancel=function(){r.go("payments")},u(),e.selectPartyId=function(t){e.paymentsDetails.partyId=t._id},a.paymentsId&&(e.pagetitle="Edit Payments",t.getPaymentsRecord(a.paymentsId,function(t){t.data.status?(e.paymentsDetails=t.data.paymentsDetails,e.paymentsDetails.date=new Date(e.paymentsDetails.date),e.paymentsDetails.amount=parseInt(e.paymentsDetails.amount),u()):t.data.messages.forEach(function(e){n.error({message:e})})},function(e){})),e.cancel=function(){r.go("payments")},e.AddorUpdatePayments=function(){var s=e.paymentsDetails;s.error=[],s.success=[],s.date||s.error.push("InValid Date"),s.partyId||s.error.push("Invalid Party Id"),s.amount||s.error.push("Invalid Amount"),s.paymentType||s.error.push("Select payment type"),"NEFT"!==s.paymentType&&"Cheque"!==s.paymentType||s.paymentRefNo||s.error.push("Enter payment reference number"),s.error.length||(a.paymentsId?t.updateRecord(s,function(e){e.data.status?(n.success({message:e.data.messages[0]}),r.go("payments")):e.data.messages.forEach(function(e){n.error({message:e})}),r.go("payments")},function(e){console.log(e)}):t.addPayments(s,function(e){e.data.status?(s.success=e.data.message,n.success({message:e.data.messages[0]}),r.go("payments")):e.data.messages.forEach(function(e){n.error({message:e})})}))}}]),app.controller("PendingBalanceCtrl",["$scope","$state","TripServices","DriverService","PartyService","TripLaneServices","$stateParams","Notification","TrucksService","PaymentsService",function(e,t,a,r,n,s,o,i,u,c){e.frieghtAmountPartyIdDetails=[],e.PartyAmountPartyIdDetails=[],e.getPendingBalance=function(){a.getFrieghtSum(function(t){t.data.status&&(e.totalFreightAmount=t.data.amounts[0].total)},function(e){}),c.getTotalAmount(function(t){t.data.status&&(e.totalAmount=t.data.amounts[0].total)},function(e){})},e.getPartyDetailsPendingBalance=function(){a.partyTotalFrieghtAmount(function(t){t.data.status&&(e.partiesTotalFrieghtDetails=t.data.amounts,console.log(e.partiesTotalFrieghtDetails))},function(e){}),c.partyTotalAmount(function(t){t.data.status&&(e.partiesTotalAmountDetails=t.data.amounts,console.log(e.partiesTotalAmountDetails))},function(e){})}}]),app.factory("RoleServices",["$http",function(e){return{addRole:function(t,a,r){e({url:"/v1/roles/role/add",method:"POST",data:t}).then(a,r)},getRoles:function(t,a,r){e({url:"/v1/roles/getRoles/"+t,method:"GET"}).then(a,r)},getAllRoles:function(t,a){e({url:"/v1/roles/getAllRoles",method:"GET"}).then(t,a)},getRole:function(t,a,r){e({url:"/v1/roles/getRole/"+t,method:"GET"}).then(a,r)},updateRole:function(t,a,r){e({url:"/v1/roles/role/update",method:"POST",data:t}).then(a,r)},deleteRole:function(t,a,r){e({url:"/v1/roles/role/delete/"+t,method:"DELETE"}).then(a,r)}}}]),app.controller("RolesCtrl",["$scope","$state","RoleServices","Notification",function(e,t,a,r){e.goToEditRolePage=function(e){t.go("rolesEdit",{roleId:e})},e.totalItems=200,e.maxSize=5,e.pageNumber=1,e.getRoles=function(){a.getRoles(e.pageNumber,function(t){t.data.status?(e.roleGridOptions.data=t.data.roles,e.totalItems=t.data.count):t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.getRoles(),e.deleteRole=function(t){a.deleteRole(t,function(t){t.data.status?(e.getRoles(),r.success({message:"Successfully deleted"})):t.data.messages.forEach(function(e){r.error({message:e})})})},e.roleGridOptions={enableSorting:!0,paginationPageSizes:[9,20,50],paginationPageSize:9,columnDefs:[{name:"Role name",field:"roleName"},{name:"Created By",field:"attrs.createdByName"},{name:"Action",cellTemplate:'<div class="text-center"><a ng-click="grid.appScope.goToEditRolePage(row.entity._id)" class="glyphicon glyphicon-edit edit"></a><a ng-click="grid.appScope.deleteRole(row.entity._id)" class="glyphicon glyphicon-trash dele"></a></div>'}],rowHeight:30,data:[],onRegisterApi:function(t){e.gridApi=t}}}]),app.controller("rolesEditController",["$scope","RoleServices","$stateParams","$state","Notification",function(e,t,a,r,n){e.pagetitle="Add Role",e.rolesDetails={roleName:"",errors:[]},e.goToRolesPage=function(){r.go("roles")},a.roleId&&(e.pagetitle="Update Role",t.getRole(a.roleId,function(t){t.data.status?e.rolesDetails=t.data.role:t.data.messages.forEach(function(e){n.error(e)})},function(e){})),e.AddorUpdateRole=function(){var s=e.rolesDetails;s.errors=[],s.roleName||s.errors.push("Invalid role name"),s.errors.length||(a.roleId?t.updateRole(s,function(e){e.data.status?(r.go("roles"),n.success({message:"Role Updated Successfully"})):s.errors=e.data.messages},function(e){}):t.addRole({roleName:s.roleName},function(e){e.data.status?(s.success=e.data.message,r.go("roles"),n.success({message:"Role Added Successfully"})):s.errors=e.data.messages},function(e){}))}}]),app.factory("TrackMapServices",["$http",function(e){return{getEventsData:function(t,a,r){e({url:"/v1/events/get/trackEvents/"+t,method:"GET"}).then(a,r)}}}]),app.controller("ShowTrackMapCtrl",["$scope","$uibModal","TrackMapServices","TrucksService","Notification",function(e,t,a,r,n){e.eventData=null,e.showOnlyStops=!1,e.totalSpeed=0,r.getAccountTrucks(1,function(t){if(t.data.status){e.trucks=t.data.trucks;var a=_.find(e.trucks,function(t){return t._id.toString()===e.registrationNo});a&&(e.truckRegNo=a.registrationNo)}else t.data.messages(function(e){n.error(e)})},function(e){}),e.loadMap=function(){e.lat=e.eventData[e.eventData.length/2].latitude,e.long=e.eventData[e.eventData.length/2].longitude;var t={center:new google.maps.LatLng(e.lat,e.long),zoom:9,mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.Map(document.getElementById("map"),t);if(e.showOnlyStops){for(r=0;r<e.eventData.length;r++)if(0==e.eventData[r].speed){e.lat=e.eventData[r].latitude,e.long=e.eventData[r].longitude;n=new google.maps.LatLng(e.lat,e.long),new google.maps.Marker({position:n,map:a,title:"marker : "+(r+1)})}}else{e.totalSpeed=0;for(var r=0;r<e.eventData.length;r++){e.lat=e.eventData[r].latitude,e.long=e.eventData[r].longitude;var n=new google.maps.LatLng(e.lat,e.long);new google.maps.Marker({position:n,map:a,title:"marker"+(r+1)+": "+e.eventData[r].speed});e.totalSpeed+=e.eventData[r].speed}}e.averageSpeed=e.totalSpeed/e.eventData.length},e.getData=function(t){a.getEventsData(t,function(t){if(t.data.status)if(e.eventData=t.data.results,0==e.eventData.length){n.error("No data exists for :"+e.registrationNo);new google.maps.Map(document.getElementById("map"))}else e.loadMap();else t.data.messages(function(e){n.error(e)})},function(e){n.error(e)})},e.selectTruckId=function(t){e.registrationNo=t.registrationNo,e.getData(e.registrationNo)}}]),app.factory("TripLaneServices",["$http",function(e){return{addTripLane:function(t,a,r){e({url:"/v1/tripLanes/",method:"POST",data:t}).then(a,r)},getAllAccountTripLanes:function(t,a){e({url:"/v1/tripLanes/all/accountTrips",method:"GET"}).then(t,a)},getTripLanes:function(t,a,r){e({url:"/v1/tripLanes/getTripLanes",method:"GET",params:t}).then(a,r)},getTripLane:function(t,a,r){e({url:"/v1/tripLanes/update/"+t,method:"GET"}).then(a,r)},updateTripLane:function(t,a,r){e({url:"/v1/tripLanes/",method:"PUT",data:t}).then(a,r)},deleteTripLane:function(t,a,r){e({url:"/v1/tripLanes/"+t,method:"DELETE"}).then(a,r)},count:function(t,a){e({url:"/v1/tripLanes/total/count",method:"GET"}).then(t,a)}}}]),app.controller("ShowTripLanesCtrl",["$scope","$uibModal","NgTableParams","TripLaneServices","paginationService","$state","Notification",function(e,t,a,r,n,s,o){e.goToEditTripLanePage=function(e){s.go("tripLanesEdit",{tripLaneId:e})},e.count=0,r.count(function(t){t.data.status?(e.count=t.data.count,e.init()):o.error({message:t.data.message})});e.init=function(){e.tripLanesParams=new a({page:1,size:10,sorting:{name:-1}},{counts:[],total:e.count,getData:function(t){var a,n;n={page:(a=t).page(),size:a.count(),sort:a.sorting()},e.loading=!0,r.getTripLanes(n,function(t){e.invalidCount=0,angular.isArray(t.data.tripLanes)&&(e.loading=!1,e.trips=t.data.tripLanes,a.total(t.totalElements),a.data=e.trips,e.currentPageOfTrips=e.trips)})}})},e.deleteTripLane=function(t){r.deleteTripLane(t,function(t){t?(e.init(),o.error({message:"Trip Lane Deleted"})):console.log("Error in deleting")})}}]),app.controller("AddEditTripLaneCtrl",["$scope","$state","Utils","TripLaneServices","$stateParams","Notification",function(e,t,a,r,n,s){console.log("tl--\x3e",n),e.pagetitle="Add Trip Lane",e.drivers=[],e.parties=[],e.tripLane={name:"",from:"",to:"",estimatedDistance:"",error:[],success:[]},e.cancel=function(){t.go("tripLanes")},n.tripLaneId&&(e.pagetitle="Edit Trip Lane",r.getTripLane(n.tripLaneId,function(t){console.log("acc===>",t.data),t.data.status?e.tripLane=t.data.tripLane:s.error(t.data.message)},function(e){})),e.addOrUpdateTripLane=function(){var a=e.tripLane;a.success=[],a.error=[],console.log(a.error),a.name||a.error.push("Invalid Trip Lane Name"),a.from||a.error.push("Invalid From Location"),a.to||a.error.push("Invalid to Location"),a.estimatedDistance||a.error.push("Invalid Estimated Dist"),a.error.length||(a._id?r.updateTripLane(a,function(e){e.data.status?(a.success=e.data.message,t.go("tripLanes"),s.success({message:e.data.message})):a.error=e.data.message},function(e){}):r.addTripLane(a,function(e){e.data.status?(a.success=e.data.message,t.go("tripLanes"),s.success({message:e.data.message})):a.error=e.data.message},function(e){}))}}]),app.factory("TripServices",["$http",function(e){return{addTrip:function(t,a,r){e({url:"/v1/trips/addTrip",method:"POST",data:t}).then(a,r)},getAllTrips:function(t,a){e({url:"/v1/trips/getAllTrips/",method:"GET"}).then(t,a)},getTrip:function(t,a,r){e({url:"/v1/trips/"+t,method:"GET"}).then(a,r)},updateTrip:function(t,a,r){e({url:"/v1/trips/",method:"PUT",data:t}).then(a,r)},deleteTrip:function(t,a,r){e({url:"/v1/trips/"+t,method:"DELETE"}).then(a,r)},addPayment:function(t,a,r){e({url:"/v1/payments",method:"PUT",data:t}).then(a,r)},getAllAccountTrips:function(t,a,r){e({url:"/v1/trips/getAllAccountTrips",method:"GET",params:t}).then(a,r)},findTotalRevenue:function(t,a){e({url:"/v1/trips/find/totalRevenue",method:"GET"}).then(t,a)},findRevenueByVehicle:function(t,a,r){e({url:"/v1/trips/find/revenueByVehicle",method:"GET",params:t}).then(a,r)},count:function(t,a){e({url:"/v1/trips/total/count",method:"GET"}).then(t,a)},shareRevenueDetailsByVechicleViaEmail:function(t,a,r){e({url:"/v1/trips/shareRevenueDetailsByVechicleViaEmail",method:"GET",params:t}).then(a,r)},getPartiesByTrips:function(t,a){e({url:"/v1/trips/getPartiesByTrips",method:"GET"}).then(t,a)}}}]),app.controller("ShowTripsCtrl",["$scope","$uibModal","TripServices","$state","Notification","paginationService","NgTableParams","TrucksService",function(e,t,a,r,n,s,o,i){e.goToEditTripPage=function(e){r.go("tripsEdit",{tripId:e})},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):n.error({message:t.data.message})})},e.getCount();var u=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting(),truckNumber:t.truckNumber};e.loading=!0,a.getAllAccountTrips(r,function(a){e.invalidCount=0,angular.isArray(a.data.trips)&&(e.loading=!1,e.trips=a.data.trips,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.trips,e.currentPageOfTrips=e.trips)})};e.getAllTrucks=function(){i.getAllTrucksForFilter(function(t){t.data.status?e.trucksList=t.data.trucks:t.data.messages.forEach(function(e){n.error({message:e})})},function(e){})},e.init=function(){e.tripParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){u(t),e.getAllTrucks()}})},e.deleteTrip=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(r=>{r.value&&a.deleteTrip(t,function(t){t.data.status?(swal("Deleted!","Trip deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){swal("Error!",e,"error")})})})},e.searchByVechicleNumber=function(t){e.tripParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.truckNumber=t,u(e)}})}}]),app.controller("AddEditTripCtrl",["$scope","$state","Utils","TripServices","DriverService","PartyService","TripLaneServices","$stateParams","Notification","TrucksService",function(e,t,a,r,n,s,o,i,u,c){function l(){s.getAllPartiesByTransporter(function(t){if(t.data.status){e.parties=t.data.parties;var a=_.find(e.parties,function(t){return t._id.toString()===e.trip.partyId});a&&(e.partyName=a.name,e.tripLanes=a.tripLanes)}else t.data.messages.forEach(function(e){u.error(e)})},function(e){})}function d(){c.getAllTrucksForFilter(function(t){if(t.data.status){e.trucks=t.data.trucks;var a=_.find(e.trucks,function(t){return t._id.toString()===e.trip.registrationNo});a&&(e.truckRegNo=a.registrationNo)}else t.data.messages(function(e){u.error(e)})},function(e){})}function p(){n.getAllDriversForFilter(function(t){if(t.data.status){e.drivers=t.data.drivers;var a=_.find(e.drivers,function(t){return t._id.toString()===e.trip.driverId});a&&(e.driverName=a.fullName)}else t.data.messages(function(e){u.error(e)})},function(e){})}e.pagetitle="Add Trip",e.drivers=[],e.parties=[],e.trucks=[],e.isFirstOpen=!0,e.trip={date:"",driverId:"",partyId:"",registrationNo:"",freightAmount:"",tripLane:"",tonnage:"",rate:"",remarks:"",error:[],success:[],share:!1,vechicleNo:"",driverName:""},e.cancel=function(){t.go("trips")},e.selectBookedFor=function(t){e.trip.bookedFor=t._id},e.selectTruckId=function(t){e.trip.registrationNo=t._id,e.trip.vechicleNo=t.registrationNo},e.selectTruckDriver=function(t){e.trip.driverId=t._id,e.trip.driverName=t.fullName,e.trip.driverNumber=t.mobile},e.selectParty=function(t){e.tripLanes=t.partyId.tripLanes},e.getTrip=function(){r.getTrip(i.tripId,function(t){t.data.status?(e.trip=t.data.trip,e.trip.date=new Date(e.trip.date),d(),l(),p()):t.data.messages.forEach(function(e){u.error(e)})},function(e){})},e.showHistory=!1,i.tripId?(e.showHistory=!0,e.pagetitle="Edit Trip",e.getTrip()):(d(),l(),p()),e.paymentFlag=!1,e.addPaymentFlag=function(){e.paymentFlag=!0},e.removePaymentFlag=function(){e.paymentFlag=!1},e.paymentDetails={tripId:"",paymentDate:"",amount:"",paymentType:"",errors:[],success:[]},e.addOrUpdateTrip=function(){var a=e.trip;a.errors=[],a.date||a.errors.push("Please Provide Trip Date"),a.registrationNo||a.errors.push("Please Provide Registration Number"),a.driverId||a.errors.push("Please Select Driver"),a.errors.length||(a._id?(a.date=Number(a.date),"string"==typeof e.trip.tripLane&&(e.trip.tripLane={name:e.trip.tripLane}),r.updateTrip(e.trip,function(e){e.data.status?(u.success({message:"Trip updated successfully"}),t.go("trips")):a.errors.push(e.data.message)},function(e){})):r.addTrip(e.trip,function(e){e.data.status?(u.success("Trip added successfully"),t.go("trips")):a.errors=e.data.message},function(e){}))},e.$watch("trip.tonnage",function(t,a){e.calculateFreightAmount()}),e.$watch("trip.rate",function(t,a){e.calculateFreightAmount()}),e.calculateFreightAmount=function(){return e.trip.tonnage>0&&e.trip.rate>0&&(e.trip.freightAmount=e.trip.tonnage*e.trip.rate),e.trip.freightAmount}}]),app.factory("TrucksService",["$http","$cookies",function(e,t){return{addTruck:function(t,a,r){e({url:"/v1/trucks/",method:"POST",data:t}).then(a,r)},getTruck:function(t,a,r){e({url:"/v1/trucks/"+t,method:"GET"}).then(a,r)},getAccountTrucks:function(t,a,r){e({url:"/v1/trucks/get/accountTrucks/"+t,method:"GET"}).then(a,r)},getAllTrucks:function(t,a,r){e({url:"/v1/trucks/groupTrucks/",method:"GET",params:t}).then(a,r)},getUnAssignedTrucks:function(t,a,r){e({url:"/v1/trucks/getUnAssignedTrucks/getAll/",method:"GET",params:t}).then(a,r)},updateTruck:function(t,a,r){e({url:"/v1/trucks",method:"PUT",data:t}).then(a,r)},deleteTruck:function(t,a,r){e({url:"/v1/trucks/"+t,method:"DELETE"}).then(a,r)},getAllAccountTrucks:function(t,a){e({url:"/v1/trucks",method:"GET"}).then(t,a)},assignTrucks:function(t,a,r){e({url:"/v1/trucks/assignTrucks",method:"POST",data:t}).then(a,r)},unAssignTrucks:function(t,a,r){e({url:"/v1/trucks/unassign-trucks",method:"POST",data:t}).then(a,r)},findExpiryCount:function(t,a){e({url:"/v1/trucks/findExpiryCount",method:"GET"}).then(t,a)},findExpiryTrucks:function(t,a,r){e({url:"/v1/trucks/findExpiryTrucks",method:"GET",params:t}).then(a,r)},fitnessExpiryTrucks:function(t,a){e({url:"/v1/trucks/fitnessExpiryTrucks",method:"GET"}).then(t,a)},permitExpiryTrucks:function(t,a){e({url:"/v1/trucks/permitExpiryTrucks",method:"GET"}).then(t,a)},insuranceExpiryTrucks:function(t,a){e({url:"/v1/trucks/insuranceExpiryTrucks",method:"GET"}).then(t,a)},pollutionExpiryTrucks:function(t,a){e({url:"/v1/trucks/pollutionExpiryTrucks",method:"GET"}).then(t,a)},taxExpiryTrucks:function(t,a){e({url:"/v1/trucks/taxExpiryTrucks",method:"GET"}).then(t,a)},count:function(t,a){e({url:"/v1/trucks/total/count",method:"GET"}).then(t,a)},searchByTruckName:function(t,a,r){e({url:"/v1/trucks/searchByTruckName",method:"GET",params:{truckName:t}}).then(a,r)},shareExpiredDetailsViaEmail:function(t,a,r){e({url:"/v1/trucks/shareExpiredDetailsViaEmail",method:"GET",params:t}).then(a,r)},getAllTrucksForFilter:function(t,a){e({url:"/v1/trucks/getAllTrucksForFilter",method:"GET"}).then(t,a)}}}]),app.controller("TrucksController",["$scope","$uibModal","TrucksService","Notification","$state","paginationService","NgTableParams","$rootScope",function(e,t,a,r,n,s,o,i){e.goToEditTruckPage=function(e){n.go("trucksEdit",{truckId:e})},e.getBackGroundColor=function(e){var t=new Date(e);return t<new Date?"expired":new Date>new Date(t.setDate(t.getDate()-15))?"expirewithin15days":""},e.count=0,e.getCount=function(){a.count(function(t){t.data.status?(e.count=t.data.count,e.init()):r.error({message:t.data.message})})},e.getCount();var u=function(t){var r={page:t.page(),size:t.count(),sort:t.sorting(),truckName:t.truckName};e.loading=!0,a.getAllTrucks(r,function(a){e.invalidCount=0,angular.isArray(a.data.trucks)&&(e.loading=!1,e.trucks=a.data.trucks,e.userId=a.data.userId,e.userType=a.data.userType,t.total(a.totalElements),t.data=e.trucks,e.currentPageOfTrucks=e.trucks)})};e.getAllTrucks=function(){a.getAllTrucksForFilter(function(t){t.data.status?e.trucksList=t.data.trucks:t.data.messages.forEach(function(e){r.error({message:e})})},function(e){})},e.init=function(){e.truckParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(t){u(t),e.getAllTrucks()}})},e.deleteTruck=function(t){swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#E83B13",cancelButtonColor:"#9d9d9d",confirmButtonText:"Yes, delete it!"}).then(r=>{r.value&&a.deleteTruck(t,function(t){t.data.status?(swal("Deleted!","Truck deleted successfully.","success"),e.getCount()):t.data.messages.forEach(function(e){swal("Deleted!",e,"error")})},function(e){})})},e.searchByTruckName=function(t){e.truckParams=new o({page:1,size:10,sorting:{createdAt:-1}},{counts:[],total:e.count,getData:function(e){e.truckName=t,u(e)}})}}]),app.controller("AddEditTruckCtrl",["$scope","Utils","TrucksService","DriverService","$stateParams","Notification","$state",function(e,t,a,r,n,s,o){e.goToTrucksPage=function(){o.go("trucks")},e.drivers=[],e.truck={registrationNo:"",truckType:"",tonnage:"",modelAndYear:"",driverId:"",fitnessExpiry:"",permitExpiry:"",insuranceExpiry:"",pollutionExpiry:"",taxDueDate:"",errors:[]},e.driverName="",e.pageTitle=n.truckId?"Update Truck":"Add Truck",r.getAllDrivers(function(t){t.data.status?(e.drivers=t.data.drivers,n.truckId&&a.getTruck(n.truckId,function(t){if(t.data.status){e.truck=t.data.truck,e.truck.fitnessExpiry=new Date(e.truck.fitnessExpiry),e.truck.insuranceExpiry=new Date(e.truck.insuranceExpiry),e.truck.permitExpiry=new Date(e.truck.permitExpiry),e.truck.pollutionExpiry=new Date(e.truck.pollutionExpiry),e.truck.taxDueDate=new Date(e.truck.taxDueDate),e.userId=t.data.userId,e.userType=t.data.userType;var a=_.find(e.drivers,function(t){return t._id.toString()===e.truck.driverId});a&&(e.driverName=a.fullName)}else t.data.messages.forEach(function(e){s.error(e)})},function(e){})):t.data.messages.forEach(function(e){s.error({message:e})})},function(e){}),e.addOrUpdateTruck=function(){var t=e.truck;t.errors=[],t.registrationNo||t.errors.push("Invalid Registration ID"),t.truckType||t.errors.push("Invalid truckType"),t.modelAndYear||t.errors.push("Invalid Modal and Year"),t.fitnessExpiry||t.errors.push("Invalid Fitness Expiry"),t.permitExpiry||t.errors.push("Invalid Permit Expiry"),t.insuranceExpiry||t.errors.push("Invalid Insurance Expiry"),t.pollutionExpiry||t.errors.push("Invalid Pollution Expiry"),t.taxDueDate||t.errors.push("Invalid Tax due date"),t.errors.length||(t._id?a.updateTruck(t,function(e){e.data.status?(o.go("trucks"),s.success({message:"Truck Updated Successfully"})):t.errors=e.data.messages},function(e){}):a.addTruck(t,function(e){e.data.status?(o.go("trucks"),s.success({message:"Truck Added Successfully"})):t.errors=e.data.messages},function(e){}))}}]),app.factory("UserServices",["$http",function(e){return{addUser:function(t,a,r){e({url:"/v1/user/addUser",method:"POST",data:t}).then(a,r)},getAllUsers:function(t,a,r){e({url:"/v1/user/getAllUsers/"+t,method:"GET"}).then(a,r)},getUser:function(t,a,r){e({url:"/v1/user/getUser/"+t,method:"GET"}).then(a,r)},updateUser:function(t,a,r){e({url:"/v1/user/updateUser",method:"POST",data:t}).then(a,r)}}}]),app.controller("UserCtrl",["$scope","$state","UserServices","Notification",function(e,t,a,r){e.goToEditUserPage=function(e){t.go("usersEdit",{userId:e})},e.totalItems=200,e.maxSize=5,e.pageNumber=1,e.getAllUsers=function(){a.getAllUsers(e.pageNumber,function(t){t.data.status?(e.userGridOptions.data=t.data.users,e.totalItems=t.data.count):t.data.messages.forEach(function(e){r.error({message:e})})})},e.getAllUsers(),e.userGridOptions={enableSorting:!0,paginationPageSizes:[9,20,50],paginationPageSize:9,columnDefs:[{name:"User name",field:"userName"},{name:"First name",field:"firstName"},{name:"Last name",field:"lastName"},{name:"Role",field:"attrs.roleName"},{name:"Created By",field:"attrs.createdByName"},{name:"Action",cellTemplate:'<div class="text-center"><a href="#" ng-click="grid.appScope.goToEditUserPage(row.entity._id)" class="glyphicon glyphicon-edit edit"> </a></div>'}],rowHeight:30,data:[],onRegisterApi:function(t){e.gridApi=t}}}]),app.controller("userEditController",["$scope","UserServices","RoleServices","AccountServices","Notification","$stateParams","Utils","$state",function(e,t,a,r,n,s,o,i){e.pagetitle="Add User",e.userDetails={accountId:"",firstName:"",lastName:"",email:"",userName:"",role:"",password:"",status:!0,isActive:!0,errors:[]},s.userId&&(e.pagetitle="Update User",t.getUser(s.userId,function(t){t.data.status?(e.userDetails=t.data.user,console.log("$scope.userDetails",e.userDetails)):t.data.messages.forEach(function(e){n.error(e)})},function(e){})),a.getAllRoles(function(t){t.data.status?(e.roles=t.data.roles,console.log("roles",e.roles)):t.data.messages.forEach(function(e){n.error({message:e})})},function(e){}),e.goToUsersPage=function(e){i.go("users")},e.AddorUpdateUSer=function(){var a=e.userDetails;console.log(a),a.errors=[],a.firstName||a.errors.push("Invalid first name"),a.lastName||a.errors.push("Invalid last name"),a.email||a.errors.push("Invalid email"),a.userName||a.errors.push("Invalid user name"),a.role||a.errors.push("Invalid role"),o.isValidPassword(a.password)||a.errors.push("Password must have  minimum 7 characters"),a.errors.length||(s.userId?t.updateUser(a,function(e){e.data.status?(i.go("users"),n.success({message:"User Updated Successfully"})):a.errors=e.data.messages},function(e){}):t.addUser(a,function(e){e.data.status?(i.go("users"),n.success({message:"User Added Successfully"})):a.errors=e.data.messages},function(e){}))}}]);